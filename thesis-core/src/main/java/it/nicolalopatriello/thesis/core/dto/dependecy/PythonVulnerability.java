package it.nicolalopatriello.thesis.core.dto.dependecy;

import it.nicolalopatriello.thesis.common.Jsonizable;
import lombok.Getter;
import lombok.Setter;
import lombok.extern.log4j.Log4j;

import java.io.File;
import java.util.HashMap;
import java.util.List;
import java.util.Optional;

@Log4j
@Getter
@Setter
public class PythonVulnerability extends HashMap<String, List<PythonVulnerability.Item>> {

    @Getter
    @Setter
    public static class Item {
        private String advisory;
        private String cve;
        private String id;
        private List<String> specs;
        private String v;

        public boolean match(String version) {
            return false;
        }
    }

    public static Optional<PythonVulnerability> from(File f) {
        try {
            HashMap<?, ?> obj = Jsonizable.fromFile(f, HashMap.class);
            obj.remove("$meta");
            Optional<PythonVulnerability> t = Optional.ofNullable(Jsonizable.fromJson(Jsonizable.toJson(obj), PythonVulnerability.class));
            System.err.println(" +++++++++ " + Jsonizable.toJson(t.get()));
            return t;
        } catch (Exception e) {
            log.error(e.getMessage(), e);
        }
        return Optional.empty();
    }
}
